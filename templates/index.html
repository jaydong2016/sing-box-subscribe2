<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="https://raw.githubusercontent.com/Toperlock/sing-box-subscribe/main/public/favicon.ico" type="image/x-icon">
    <title>生成sing-box配置</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #2d3436;
            line-height: 1.6;
        }

        .container {
            width: 90%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #4a90e2;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
        }

        h1::after {
            content: '';
            display: block;
            width: 60px;
            height: 3px;
            background: #6c5ce7;
            margin: 0.5rem auto;
            border-radius: 2px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            margin: 0 auto;
        }

        textarea:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 10px rgba(74, 144, 226, 0.2);
            outline: none;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        button, input[type="submit"] {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        button:hover, input[type="submit"]:hover {
            background: #6c5ce7;
            transform: translateY(-2px);
        }

        select {
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            margin-right: 1rem;
            transition: all 0.3s ease;
        }

        select:focus {
            border-color: #4a90e2;
            outline: none;
        }

        .config-content {
            margin-top: 2rem;
            background: rgba(245, 247, 250, 0.9);
            padding: 1.5rem;
            border-radius: 8px;
            width: 100%;
        }

        .config-content h3 {
            margin: 1rem 0;
            font-size: 1rem;
            padding: 0.8rem;
            border-left: 4px solid #4a90e2;
            background: rgba(255, 255, 255, 0.9);
        }

        .config-content a {
            color: #6c5ce7;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .config-content a:hover {
            color: #4a90e2;
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 1rem;
            }

            h1 {
                font-size: 1.8rem;
            }

            textarea {
                min-height: 150px;
            }

            .button-group {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="right-box">
            <h1>生成sing-box配置</h1>

            <!-- 新增：网址生成部分 -->
            <div style="width: 100%; margin-bottom: 1.5rem;">
                <label for="url-suffix" style="font-weight: bold; display: block; margin-bottom: 0.5rem;">输入订阅链接网址：</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input 
                        type="text" 
                        id="url-suffix" 
                        placeholder="支持填入 Base64 的 http/s 订阅链接" 
                        style="flex: 1; padding: 0.8rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem;"
                    >
                    <button 
                        onclick="generateFullUrl()" 
                        style="background: #4a90e2; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; cursor: pointer;"
                    >
                        生成 sing-box 1.12 订阅
                    </button>
                </div>
                <p id="full-url" style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;"></p>
            </div>

            <div style="width: 100%; margin-bottom: 1.5rem;">
                <label for="url-suffix" style="font-weight: bold; display: block; margin-bottom: 0.5rem;">以下为独立操作，可选择生成配置文件版本：</label>
                <p id="full-url" style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;"></p>
            </div>


            <!-- 原有表单部分 -->
            <form id="temp-json-form" method="POST" action="/edit_temp_json">
                <textarea 
                    name="temp_json_data" 
                    placeholder="在此粘贴您的JSON配置..."
                    spellcheck="false"
                >{{ temp_json_data | default('') }}</textarea>
                
                <div class="button-group">
                    <input type="submit" value="保存">
                </div>
            </form>

            <div class="form-container">
                <form method="POST" action="/generate_config">
                    <div class="button-group">
                        <select name="template_index">
                            {% for option in template_options %}
                            <option value="{{ loop.index - 1 }}">{{ option }}</option>
                            {% endfor %}
                        </select>
                        <input type="submit" value="生成配置文件">
                    </div>
                </form>
            </div>

            <div class="config-content">
                <h3><a href="https://github.com/Toperlock/sing-box-subscribe#%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" target="_blank" rel="noopener noreferrer">请务必：点击查看操作说明！！！</a></h3>
                <h3><a href="https://github.com/Toperlock/sing-box-subscribe/tree/main/instructions#steps-for-page-manipulation" target="_blank" rel="noopener noreferrer">Please be sure to: Click to view operation instructions!!!</a></h3>
                <!-- 其他说明内容保持不变 -->
            </div>
        </div>
    </div>
    <script>
        // 新增：生成完整网址的函数
 async function generateFullUrl() {
    // 获取当前网站的域名和协议作为基础 URL
    const baseUrl = `${window.location.origin}/config/`;
    const suffix = document.getElementById('url-suffix').value.trim();

    if (suffix) {
        const fullUrl = `${baseUrl}${suffix}`;
        document.getElementById('full-url').textContent = `sing-box 订阅网址：${fullUrl}`;

        try {
            await navigator.clipboard.writeText(fullUrl);
            alert('完整网址已复制到剪贴板！');
        } catch (err) {
            alert('复制到剪贴板失败！请手动复制。' + err);
        }
    } else {
        document.getElementById('full-url').textContent = '请输入有效的网址后缀！';
    }
}


        // 原有JavaScript逻辑保持不变
        const initialTempJsonData = '{"subscribes":[{"url":"URL","tag":"tag_1","enabled":true,"emoji":0,"subgroup":"","prefix":"","User-Agent":"v2rayng"},{"url":"URL","tag":"tag_2","enabled":false,"emoji":0,"subgroup":"命名/named","prefix":"❤️","User-Agent":"clashmeta"}],"auto_set_outbounds_dns":{"proxy":"","direct":""},"save_config_path":"./config.json","auto_backup":false,"exclude_protocol":"ssr","config_template":"","Only-nodes":false}';
        let tempJsonData = initialTempJsonData;
        document.querySelector('#temp-json-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const response = await fetch(form.action, {
                method: form.method,
                body: formData,
            });
            if (response.ok) {
                const responseData = await response.text();
                const configContent = document.querySelector('#config-text');
                configContent.textContent = responseData;
            }
        });

        const languageData = {
            "1": "2024-1-10: My vercel free plan Usage is almost used up by you. If you have a github account, please fork this project and use the subscription conversion website you built. Otherwise, I will decide to close this website.",
            "2": "Prerequisite: Fill in the subscription link correctly on this web page. The failure to generate the configuration is because someone else is generating the configuration at the same time, causing the content you filled in to be cleared. It is recommended to use the form /config/URL.",
            // 其他翻译内容保持不变
        };

        let isEnglish = false;

        function toggleLanguage() {
            isEnglish = !isEnglish;
            const elementsToTranslate = document.querySelectorAll('[data-translate]');
            elementsToTranslate.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (isEnglish && languageData[key]) {
                    element.textContent = languageData[key];
                } else {
                    window.location.reload();
                }
            });
        }
    </script>
</body>
</html>